<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaid Test Kit</title>
    <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- Status Display -->
    <div id="globalStatus"></div>

    <!-- Link Configuration Banner -->
    <div id="configBanner" class="card hidden"
        style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 4px solid #6366f1;">
        <div class="grid grid-2">
            <div>
                <h4 style="margin: 0; color: #1e40af;">Custom Link Configuration Active</h4>
                <p style="margin: 5px 0 0 0; color: #1e40af;" id="configSummary">Custom settings are being used for Link
                    token creation.</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center; justify-content: flex-end;">
                <button class="btn btn-outline" onclick="viewConfiguration()">View Config</button>
                <button class="btn btn-secondary" onclick="clearConfiguration()">Clear Config</button>
            </div>
        </div>
    </div>

    <!-- Link Configuration Section -->
    <div class="card">
        <h2>1Ô∏è‚É£ Link Configuration</h2>
        <p>Customize your Link token creation with advanced configuration options including products, country codes, and
            advanced parameters.</p>

        <div class="grid grid-2">
            <div class="feature-card" onclick="window.location.href='/link-config.html'">
                <h3>‚öôÔ∏è Configure Link Token</h3>
                <p>Customize products, country codes, and advanced Link token parameters.</p>
                <div style="margin: 16px 0;">
                    <h4 style="font-size: 16px; margin-bottom: 12px;">‚ö°Ô∏è Quick Configs</h4>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                        <button class="btn btn-outline btn-small"
                            onclick="event.stopPropagation(); loadPresetConfig('auth')"
                            style="padding: 8px 16px; font-size: 14px;">Auth</button>
                        <button class="btn btn-outline btn-small"
                            onclick="event.stopPropagation(); loadPresetConfig('transactions')"
                            style="padding: 8px 16px; font-size: 14px;">Transactions</button>
                        <button class="btn btn-outline btn-small"
                            onclick="event.stopPropagation(); loadPresetConfig('identity')"
                            style="padding: 8px 16px; font-size: 14px;">Identity</button>
                        <button class="btn btn-outline btn-small"
                            onclick="event.stopPropagation(); loadPresetConfig('ABI')"
                            style="padding: 8px 16px; font-size: 14px;">ABI</button>
                    </div>
                </div>
                <button class="btn btn-primary btn-full">Open Configurator</button>
            </div>

            <div style="padding: 24px;">
                <h4>Current Configuration</h4>
                <div id="configStatus" style="margin: 16px 0;">
                    <div
                        style="padding: 12px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 8px; border-left: 3px solid #10b981;">
                        <div style="font-size: 13px; color: #047857;">
                            <div><strong>Products:</strong> auth</div>
                            <div><strong>Countries:</strong> US</div>
                            <div><strong>Client:</strong> Plaid Test Kit - Auth</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>2Ô∏è‚É£ Choose Your Link Experience</h2>
        <p>Select how you'd like to test Plaid Link.</p>
        <div class="callout-banner">
            <div class="callout-title">
                <span class="callout-icon">üîí</span>
                OAuth Configuration Required
            </div>

            <div class="callout-content">
                OAuth support is automatic based on the institution you select, but you will need to add the URL below
                to the <a href="https://dashboard.plaid.com/developers/api" alt="Plaid Dashboard Link"
                    class="link">Allowed redirect URIs</a> first.
            </div>

            <div class="callout-highlight">
                <div class="redirect-url" id="baseUrl"></div>
                <button class="copy-btn" id="copyBaseUrlBtn" onclick="copyBaseUrl()">
                    Copy URL
                </button>
            </div>
        </div>
        <div class="grid grid-3">
            <div class="feature-card" onclick="startStandardLink()">
                <h3>üîó Standard Link</h3>
            </div>

            <div class="feature-card" onclick="startEmbeddedLink()">
                <h3>üì± Embedded Link</h3>
            </div>
            <div class="feature-card" onclick="startHostedLink()">
                <h3>üåê Hosted Link</h3>
            </div>
        </div>
        <div style="margin-top: 16px;"></div>
        <div class="grid grid-2">
            <div class="feature-card" onclick="startLayer()">
                <h3>‚ö°Ô∏è Layer</h3>
            </div>
            <div class="feature-card" onclick="showUpdateMode()">
                <h3>üîÑ Link Update Mode</h3>
            </div>
        </div>
    </div>

    <!-- Success Section -->
    <div id="successSection" class="card hidden">
        <h3>‚úÖ Bank Connected Successfully!</h3>
        <div id="connectionInfo"></div>

        <div class="grid grid-2 mt-2">
            <div>
                <h4>Access Token</h4>
                <div id="tokenDisplay" class="code-display"></div>
                <button class="btn btn-outline mt-1" onclick="copyAccessToken()">Copy Token</button>
            </div>

            <div>
                <p>Your bank account is now connected.</p>
                <div class="grid">
                    <button class="btn btn-outline" onclick="startPageStartOver()">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Mode Configuration -->
    <div id="updateModeCard" class="card hidden">
        <h3>Link Update Mode Configuration</h3>
        <p>Enter an existing access token to enable account selection for additional accounts.</p>

        <div class="form-group">
            <label for="updateAccessToken">Access Token:</label>
            <input type="text" id="updateAccessToken" placeholder="access-xxx..." class="form-control">
        </div>

        <div class="grid grid-2">
            <button class="btn btn-outline" onclick="hideUpdateMode()">Cancel</button>
            <button class="btn btn-success" onclick="startUpdateMode()">Start Update Mode</button>
        </div>

        <div id="updateStatus"></div>
    </div>

    <!-- Hosted Link Status Section -->
    <div id="hostedLinkCard" class="card hidden">
        <h3>Hosted Link Session</h3>
        <div id="hostedLinkInfo">
            <p>Your Hosted Link session has been created. Click the button below to open it in a new tab.</p>
        </div>

        <div class="grid grid-2">
            <button id="openHostedLink" class="btn btn-success btn-full" onclick="openHostedLinkUrl()">
                üåê Open Hosted Link
            </button>
            <button class="btn btn-outline btn-full" onclick="checkHostedLinkStatus()">
                üîÑ Check Status
            </button>
        </div>

        <div id="hostedLinkStatus" style="margin-top: 16px;"></div>

        <div style="margin-top: 16px;">
            <button class="btn btn-secondary" onclick="cancelHostedLink()">Cancel Session</button>
        </div>
    </div>

    <!-- Layer Container -->
    <div id="layerStatus" style="margin-top: 16px;"></div>

    <div id="layerContainer" class="card hidden">

        <div class="grid grid-3">
            <div class="form-column">
                <div class="form-group">
                    <label for="layerTemplateIdInput">Layer Template ID <span
                            class="required-badge">Required</span></label>
                    <input type="tel" id="layerTemplateIdInput" placeholder="template_123456XXX"
                        style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <div class="help-text">
                        You can find your Layer template ID in the Plaid Dashboard, within the Layer Template Editor.
                    </div>
                </div>
                <div class="form-group">
                    <label for="layerUserIdInput">User ID <span class="required-badge">Required</span></label>
                    <input type="tel" id="layerUserIdInput" placeholder="client_user_id_here"
                        style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px;">
                    <button type="button" class="btn btn-secondary" onclick="fillRandomUserId()">Generate Random User
                        ID</button>
                </div>
                <button id="layerInitButton" class="btn btn-primary" onclick="initializeLayerSession()">
                    Initialize Layer
                </button>
            </div>
            <div>
                <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #1e40af;"><span class="jumbo-emoji">üëà</span> First, initialize
                        Layer with your template_id and client_user_id</h4>
                </div>
                <br>
                <br>
                <div id="layerStepTwo" class="hidden" style="background: #7dff6c; padding: 12px; border-radius: 8px; font-size: 13px; color: #92400e;">
                    <h4 style="margin: 0 0 8px 0; color: #1e40af;">Success! Now, check eligiblity to launch Layer!
                    </h4>
                    <div style="text-align: right;">
                        <span class="jumbo-emoji">üëâ</span>
                    </div>
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="layerPhoneInput">Phone Number <span class="required-badge">Required</span></label>
                    <input type="tel" id="layerPhoneInput" value="+1 415-555-0015"
                        style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 8px;">
                    <div class="help-text">
                        This field is pre-filled with a "good" test number. The OTP code is 123456.
                        <a href="https://plaid.com/docs/layer/#testing-layer" class="link" target="_blank">
                            Read the Layer docs
                        </a>
                        for more info.
                    </div>
                </div>
                <button id="layerSubmitButton" class="btn btn-primary" onclick="submitLayerPhone()">
                    Check Layer Eligibility
                </button>
            </div>
            <!-- Unnecessary Informational Block, maybe use later
            <div>
                <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
                    <h4 style="margin: 0 0 8px 0; color: #1e40af;">What is Layer?</h4>
                    <p style="margin: 0; font-size: 14px; color: #1e40af;">Layer is Plaid's instant bank connection experience that eliminates the need for online banking credentials by using your phone number.</p>
                </div>
                
                <div style="background: #fef3c7; padding: 12px; border-radius: 8px; font-size: 13px; color: #92400e;">
                    <strong>Note:</strong> Layer availability depends on your phone number and financial institution. If not eligible, you can use other Link options.
                </div>
            </div> -->
        </div>
    </div>

    <!-- Link Container for Embedded Mode -->
    <div id="embeddedContainer" class="card hidden">
        <h3>Embedded Link</h3>
        <div id="linkContainer" class="link-container">
            <div class="link-container-placeholder">
                <p><strong>Embedded Link will appear here</strong></p>
                <p>Click "Start Embedded Link" above to begin</p>
            </div>
        </div>
        <div id="embeddedStatus"></div>
    </div>

    <!-- App Modules Section -->
    <div class="card">
        <h2>3Ô∏è‚É£ Testing Modules</h2>
        <p>Direct access to different Plaid API testing modules. Each module can use an existing access token or guide
            you through Link.</p>

        <div class="grid grid-4">
            <div class="feature-card" onclick="window.location.href='/auth-tester.html'">
                <h3>üè¶ Auth</h3>
            </div>

            <div class="feature-card" onclick="window.location.href='/balance-tester.html'">
                <h3>üí∞ Balance</h3>
            </div>

            <div class="feature-card" onclick="window.location.href='/identity-tester.html'">
                <h3>üÜî Identity</h3>
            </div>

            <div class="feature-card" onclick="window.location.href='/webhooks.html'">
                <h3>üîî Webhooks</h3>
            </div>
        </div>

        <!-- Load JavaScript modules -->
        <script src="/js/api-client.js"></script>
        <script src="/js/plaid-link.js"></script>
        <script src="/js/ui-utils.js"></script>
        <script src="/js/account-manager.js"></script>
        <script src="/js/layer-manager.js"></script>
        <script src="/js/start-page.js"></script>

        <!-- Populate the OAuth redirect URI section -->
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var baseUrlText = document.getElementById('baseUrl');
                if (baseUrlText && document.location.origin) {
                    baseUrlText.textContent = document.location.origin + '/oauth-redirect';
                }
            });
        </script>

        <!-- Generate random user ID -->
        <script>
            function fillRandomUserId() {
                const input = document.getElementById('layerUserIdInput');
                if (window.UIUtils && typeof window.UIUtils.generateRandomUsername === 'function') {
                    input.value = window.UIUtils.generateRandomUsername();
                } else {
                    input.value = 'user_' + Math.floor(Math.random() * 1000000); // fallback
                }
            }
        </script>
</body>

</html>